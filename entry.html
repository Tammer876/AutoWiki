<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="entry-styles.css" />
  <title>AutoWiki - Car details</title>
</head>

<body>
  <div class="sticky">
    <section class="top-bar">
      <div class="sign-buttons">
        <a href="login.html"><button>Log in</button></a>
        <a href="signup.html"><button>Sign up</button></a>
      </div>
    </section>
    <div class="divider"></div>
  </div>

  <div class="side-bar"></div>

  <main id="carDetails">
    <p>Loading car details...</p>
  </main>

  <section class="bottom-bar">
    <div class="divider"></div>
  </section>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const modelName = urlParams.get("model");
    if (!modelName) {
      alert("No car model specified.");
      return;
    }

    fetch('https://autowiki.uk/api/carlist', {
      method: 'POST'
    })
      .then(async res => {
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`API error: ${res.status} ${text}`);
        }
        return res.json();
      })
      .then(data => {
        const car = data.cars.find(c => c.model.toLowerCase() === modelName.toLowerCase());
        if (!car) {
          alert(`Car model "${modelName}" not found.`);
          return;
        }
        populateCarPage(car);
      })
      .catch(err => {
        console.error(err);
        alert("Could not load car details.");
      });
  });

  function populateCarPage(car) {
    document.title = `AutoWiki - ${car.model}`;
    document.querySelector("th").innerHTML = `${car.model} specs:`;
    document.querySelector("img").src = car.imageUrl || "stock-car-1.jpg";

    const rows = document.querySelectorAll("main table:nth-of-type(1) tr");
    rows[1].querySelector("td").textContent = `Manufacturer: ${car.manufacturer || "-"}`;
    rows[2].querySelector("td").textContent = `Production time: ${car.productionStartYear || "-"} - ${car.productionEndYear || "-"}`;
    rows[3].querySelector("td").textContent = `Price: $${car.price || "-"}`;

    const rows2 = document.querySelectorAll("main table:nth-of-type(2) tr");
    rows2[1].children[0].textContent = `Bodytype: ${car.bodyType || "-"}`;
    rows2[1].children[1].textContent = `Fuel type: ${car.fuelType || "-"}`;

    rows2[2].children[0].textContent = `Number of seats: ${car.numberOfSeats || "-"}`;
    rows2[2].children[1].textContent = `Gearbox: ${car.gearType || "-"}`;

    rows2[3].children[0].textContent = `Number of doors: ${car.numberOfDoors || "-"}`;
    rows2[3].children[1].textContent = `Drivewheels: ${car.driveWheelConfiguration || "-"}`;

    rows2[4].children[0].textContent = `Length: ${car.length || "-"} mm`;
    rows2[4].children[1].textContent = `Horsepower: ${car.enginePower || "-"}`;

    rows2[5].children[0].textContent = `Width: ${car.width || "-"} mm`;
    rows2[5].children[1].textContent = `Weight per hp: ${car.weightPerHP || "-"}`;

    rows2[6].children[0].textContent = `Height: ${car.height || "-"} mm`;
    rows2[6].children[1].textContent = `Maximum torque: ${car.engineTorque || "-"}`;

    rows2[7].children[0].textContent = `Weight: ${car.weight || "-"} kg`;
    rows2[7].children[1].textContent = `Engine displacement: ${car.engineDisplacement || "-"} cmÂ³`;

    rows2[8].children[0].textContent = `Top speed: ${car.topSpeed || "-"} km/h`;
    rows2[9].children[0].textContent = `Acceleration to 100km/h: ${car.accelerationToHundred || "-"} sec`;
  }
</script>

</body>

</html>
